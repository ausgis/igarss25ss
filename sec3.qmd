# Spatial analysis for remote sensing data

We demonstrate a spatial analysis workflow using the 2024 climate and bushfire data as an example.

We will perform spatial hot spot and cold spot analysis using the **rgeoda** package and conduct spatial stratified heterogeneity analysis using the **gdverse** package.

You can install the required packages using the following commands in the R console:

```r
install.packages(c("sf","terra","tidyverse","rgeoda","gdverse"),dep = TRUE)
```

Now we read the data to R and perform some basic data explorationï¼š

```{r fig-data-exploration, cache = FALSE, message = FALSE, echo=!knitr::is_latex_output()}
#| fig.cap: "Maps of the 2024 climate and bushfire data"
#| code-fold: true
#| fig.height: 3.5
library(terra)

burnedarea = rast('./data/1. Data collection/BurnedArea/BurnedArea_2024.tif')
burnedarea
pre = rast('./data/1. Data collection/Pre/Pre2024.tif')
pre
tem = rast('./data/1. Data collection/Tem/Tem2024.tif')
tem

par(mfrow = c(1, 3))
plot(burnedarea, main = 'Burned area')
plot(pre, main = 'Precipitation')
plot(tem, main = 'Temperature')
par(mfrow = c(1, 1))
```

Since the row and column numbers of the three rasters are not aligned, we first convert the non-NA cells of the temperature raster into a spatial polygon format. Then, we perform zonal statistics on temperature and wildfire data, and finally, remove all NA values corresponding to the three variables.

```{r fig-map-sf-format, cache = FALSE, message = FALSE, echo=!knitr::is_latex_output()}
#| fig.cap: "Maps of the 2024 climate and bushfire data in sf format"
#| code-fold: true
#| fig.height: 3.5
tem.polygon = terra::as.polygons(tem,aggregate = FALSE)
names(tem.polygon) = "tem"
tem.polygon$pre = terra::zonal(pre,tem.polygon,fun = "mean",na.rm = TRUE)[,1]
tem.polygon$burnedarea = terra::zonal(burnedarea,tem.polygon,fun = "sum",na.rm = TRUE)[,1]
burnedarea.sf = sf::st_as_sf(tem.polygon) |> 
  dplyr::filter(dplyr::if_all(1:3,\(.x) !is.na(.x)))
burnedarea.sf

library(sf)
plot(burnedarea.sf)
```

save the data to a shapefile:

```{r, eval = FALSE}
#| code-fold: true
sf::write_sf(burnedarea.sf,'./data/3. Spatial analysis/burnedarea_2024.shp',overwrite = TRUE)
```

## Spatial hotspot identification

## Geographical detector for spatial heterogeneity and factor analysis